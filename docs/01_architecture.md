# Project Logist Architecture

## Core Terminology

### Logist (Tool/Project)
The **Project Logist** is the primary orchestration tool that manages the execution of isolated, persistent jobs. It uses a Node.js-based tool, **`cline`**, as the fundamental execution primitive for running agentic tasks. It handles state management, resource tracking, Git safety practices, and flow control between automated agents and human checkpoints.

### Job (Unit of Work)
A **Job** represents a single, self-contained unit of work that requires persistent execution across multiple agent interactions. Each job is completely isolated - the Logist clones the current Git state before beginning work, creating a baseline hash that ensures safety and allows complete rollback if needed.

### Agent Run (Execution Step)
An **Agent Run** is a single execution of a Cline CLI command by a specialized agent (Worker or Supervisor). Each run either advances the job state or signals that human intervention (via The Steward) is required.

### Jobs Index (`jobs_index.json`)
The **Jobs Index** is the central registry for all jobs managed by Logist. Located in the user's configurable jobs directory (specified with `--jobs-dir`, defaulting to `~/.logist/jobs`), this file maintains two key pieces of information:
-   `current_job_id`: A global pointer to the currently selected job, allowing users to run commands like `logist job status` without specifying a job ID.
-   `jobs`: A mapping between a `job_id` and the absolute path to that job's directory on the filesystem.

It is the source of truth for locating jobs and understanding which job is currently active.

### Job Manifest (`job_manifest.json`)
The **Job Manifest** is the primary state file located *within each individual job's directory*. It is the single source of truth for a specific job, storing:
- Current job status (`PENDING`, `RUNNING`, `STUCK`, etc.) and execution phase.
- A history of all Agent Runs and Steward interventions.
- Evidence files generated by each agent run.
- Cumulative metrics (cost, time).
- Git context (baseline hash, job branch name).
- `acceptance_criteria_from_prompt`: The user-defined goal for the job (e.g., "all tests pass").
- `is_goal_achieved`: A boolean flag set by an agent when it determines the goal has been met.
- `final_stop_reason`: A string explaining why the job halted, whether by success, hitting a limit, or error.

### The Steward (Human Checkpoint)
The **Steward** represents human intervention points in the workflow. When a job reaches an ambiguous state (STUCK), completes a major phase, or encounters errors, execution pauses and waits for human review and direction before continuing.

## Execution Philosophy

### Job Isolation (Safety First)
Every job begins by creating a complete, isolated Git environment to ensure that the main project repository remains untouched during an agent's work. This is achieved by cloning the main repository into a temporary directory (`<job_root>/work/<timestamp>`).

This isolated environment serves as a staging area where "coder" agents can perform their work, including making a series of local Git commits with descriptive messages.

Key components of this strategy include:
- **Baseline Hash**: The commit hash of the original repository at the moment of cloning. This provides a clean starting point and allows for easy rollbacks.
- **Local Commits**: Agents are expected to commit their changes within the isolated clone. This preserves a detailed history of the work performed.
- **Future Integration**: While currently the isolated clone is left in place, the long-term vision is to use these agent-generated commits to create a patch file or to propose a merge back into the main repository, subject to human (Steward) approval.

### Iterative Loop Structure
The Logist enforces a strict three-phase execution loop:

1. **Worker Run (Action)**: Agent executes actual work, generating outputs and evidence files
2. **Supervisor Run (Evaluation)**: Agent reviews work quality, identifies issues, provides guidance
3. **Steward Checkpoint (Human Gate)**: Human reviews progress and decides next action

This cycle repeats until the job reaches COMPLETED status or encounters an unrecoverable error.

### Flow Control Logic
- **COMPLETED**: Worker signals job success - Logist advances to final Steward review
- **STUCK**: Worker needs clarification - pauses for Steward intervention
- **RETRY**: Supervisor recommends restarting current phase - Logist re-runs without human intervention

### Non-Destructive Previews (Dry Runs)
To aid in debugging, cost control, and build confidence in agent actions, Logist provides non-destructive preview and dry-run capabilities. These features allow users to inspect the agent's planned actions and generated prompts without incurring actual costs or modifying the project state.

-   **Prompt Preview**: Allows viewing the exact prompt intended for the next agent run without executing it.
-   **Dry Run Simulation**: Simulates an entire Worker -> Supervisor execution cycle using mock data, demonstrating the logical flow and data transformations without actual LLM calls or state changes.